---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  activeSection?: 'dashboard' | 'products' | 'categories' | 'brands' | 'orders';
}

const { title, activeSection } = Astro.props;
const user = Astro.locals.user;
const profile = Astro.locals.profile;

// Redirect if not admin
if (!user || profile?.role !== 'admin') {
  return Astro.redirect('/auth/login');
}

const navItems = [
  { 
    id: 'dashboard', 
    label: 'Dashboard', 
    href: '/admin/dashboard',
    icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>`
  },
  { 
    id: 'products', 
    label: 'Productos', 
    href: '/admin/products',
    icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>`
  },
  { 
    id: 'categories', 
    label: 'Categorías', 
    href: '/admin/categories',
    icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>`
  },
  { 
    id: 'brands', 
    label: 'Marcas', 
    href: '/admin/brands',
    icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>`
  },
  { 
    id: 'orders', 
    label: 'Pedidos', 
    href: '/admin/orders',
    icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>`
  }
];
---

<BaseLayout title={title}>
  <div class="flex h-screen bg-gray-100">
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-900 text-white flex flex-col fixed h-full">
      <!-- Logo -->
      <div class="p-6 border-b border-gray-800">
        <a href="/admin/dashboard" class="flex items-center gap-3">
          <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
            <span class="text-gray-900 font-bold text-xl">C</span>
          </div>
          <div>
            <h1 class="text-lg font-bold">CROMA</h1>
            <p class="text-xs text-gray-400">Panel Admin</p>
          </div>
        </a>
      </div>

      <!-- Navigation -->
      <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
        {navItems.map(item => (
          <a 
            href={item.href}
            class={`flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-all ${
              activeSection === item.id 
                ? 'bg-white text-gray-900' 
                : 'text-gray-400 hover:text-white hover:bg-gray-800'
            }`}
          >
            <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <Fragment set:html={item.icon} />
            </svg>
            {item.label}
          </a>
        ))}
      </nav>

      <!-- User Info & Actions -->
      <div class="p-4 border-t border-gray-800">
        <div class="mb-4 px-4 py-3 bg-gray-800 rounded-lg">
          <p class="text-sm font-medium text-white truncate">{profile?.full_name || 'Admin'}</p>
          <p class="text-xs text-gray-400 truncate">{profile?.email}</p>
        </div>
        <div class="space-y-2">
          <a 
            href="/" 
            class="flex items-center gap-2 px-4 py-2 text-sm text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition-colors"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
            </svg>
            Ver tienda
          </a>
          <a 
            href="/auth/logout" 
            class="flex items-center gap-2 px-4 py-2 text-sm text-red-400 hover:text-red-300 hover:bg-gray-800 rounded-lg transition-colors"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
            </svg>
            Cerrar sesión
          </a>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 ml-64 overflow-y-auto">
      <!-- Top Header -->
      <header class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="px-8 py-4">
          <h1 class="text-2xl font-bold text-gray-900">{title}</h1>
        </div>
      </header>

      <!-- Page Content -->
      <div class="p-8">
        <slot />
      </div>
    </main>
  </div>
</BaseLayout>
