---
import PublicLayout from '@layouts/PublicLayout.astro';
import ProductCard from '@components/product/ProductCard.astro';
import Button from '@components/ui/Button.astro';
import { supabase } from '@lib/supabase';

const { data: featuredProducts } = await supabase
  .from('products')
  .select('*')
  .eq('featured', true)
  .limit(4);

const { data: categories } = await supabase
  .from('categories')
  .select('*');
---

<PublicLayout title="Urban Collective">
  {/* Hero Section */}
  <section class="relative h-[80vh] flex items-center justify-center overflow-hidden">
    <div class="absolute inset-0 bg-gray-900">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/80 z-10"></div>
        <img 
            src="https://images.unsplash.com/photo-1490481651871-ab68624d5517?q=80&w=2000&auto=format&fit=crop" 
            alt="Hero Background" 
            class="w-full h-full object-cover scale-105 animate-slow-zoom"
            onerror="this.style.display='none';"
        />
    </div>
    
    <div class="relative z-20 text-center container-custom px-4">
      <h1 class="text-5xl md:text-8xl font-urban font-black mb-6 tracking-tighter uppercase text-white drop-shadow-2xl leading-[0.9]">
        URBAN <span class="text-transparent bg-clip-text bg-gradient-to-r from-white via-gray-400 to-white">COLLECTIVE</span>
      </h1>
      <p class="text-lg md:text-2xl text-gray-200 mb-10 max-w-2xl mx-auto font-medium tracking-wide leading-tight">
        Elevando el streetwear a una nueva dimensión de sofisticación y exclusividad.
      </p>
      <div class="flex flex-col md:flex-row gap-4 justify-center items-center">
        <Button href="/category/all" variant="primary" size="lg" class="w-full md:w-auto px-12 py-5 text-lg md:text-xl font-black italic">
          SHOP NOW
        </Button>
        <Button href="/category/viral-trends" variant="secondary" size="lg" class="w-full md:w-auto px-12 py-5 text-lg md:text-xl font-black italic border-2 md:border-4">
          EXPLORE TRENDS
        </Button>
      </div>
    </div>
  </section>

  {/* Brand Manifesto */}
  <section class="bg-white py-16 md:py-24 border-y border-gray-100">
    <div class="container-custom flex flex-col md:flex-row items-center gap-12 md:gap-16">
        <div class="flex-1 text-center md:text-left">
            <h2 class="text-[10px] md:text-xs font-black tracking-[0.5em] text-gray-400 uppercase mb-4">The Manifesto</h2>
            <h3 class="text-4xl md:text-5xl font-urban font-black text-gray-900 mb-6 md:mb-8 leading-tight">MÁS QUE MODA, <br class="hidden md:block"/>UN ESTILO DE VIDA.</h3>
            <p class="text-lg md:text-xl text-gray-600 leading-relaxed mb-8 px-4 md:px-0">
                En CROMA creemos que la ropa es el lienzo de tu identidad. Cada pieza está diseñada con una atención obsesiva al detalle, mezclando la rudeza de la calle con la precisión de la alta costura.
            </p>
            <div class="flex justify-center md:justify-start gap-12 md:gap-8">
                <div class="flex flex-col">
                    <span class="text-3xl md:text-4xl font-black text-gray-900">10k+</span>
                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Original Styles</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-3xl md:text-4xl font-black text-gray-900">100%</span>
                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Premium Quality</span>
                </div>
            </div>
        </div>
        <div class="flex-1 w-full grid grid-cols-2 gap-3 md:gap-4 px-4 md:px-0">
            <div class="aspect-[3/4] bg-gray-100 rounded-sm overflow-hidden shadow-xl">
                <img src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=800&auto=format&fit=crop" class="w-full h-full object-cover" loading="lazy" />
            </div>
            <div class="aspect-[3/4] bg-gray-100 rounded-sm overflow-hidden mt-8 md:mt-12 shadow-xl">
                <img src="https://images.unsplash.com/photo-1552374196-1ab2a1c593e8?q=80&w=800&auto=format&fit=crop" class="w-full h-full object-cover" loading="lazy" />
            </div>
        </div>
    </div>
  </section>

  {/* Featured Products */}
  {featuredProducts && featuredProducts.length > 0 && (
    <section class="container-custom py-16 md:py-24 px-4 md:px-0">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-12 md:mb-16 border-b-2 md:border-b-4 border-black pb-6 md:pb-8 gap-4">
        <div>
            <h2 class="text-4xl md:text-6xl font-urban font-black text-gray-900 uppercase italic">
                DROPS <span class="text-gray-300">/ 2026</span>
            </h2>
            <p class="text-sm md:text-xl font-bold text-gray-500 mt-2 uppercase tracking-widest text-balance">THE MOST WANTED PIECES</p>
        </div>
        <a href="/category/all" class="text-lg md:text-xl font-black hover:translate-x-2 md:hover:translate-x-4 transition-transform duration-300 flex items-center gap-2">
            SEE ALL <span class="text-2xl">→</span>
        </a>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8">
        {featuredProducts.map((product) => (
          <ProductCard product={product} />
        ))}
      </div>
    </section>
  )}

  {/* Categories */}
  <section class="bg-black py-16 md:py-24 text-white overflow-hidden">
      <div class="container-custom relative px-4 md:px-0">
        <h2 class="text-6xl md:text-8xl font-urban font-black text-white/5 absolute -top-10 md:-top-12 -left-4 md:-left-12 pointer-events-none uppercase italic">
            CATEGORIES
        </h2>
        
        {/* Mobile: Horizontal Scroll, Desktop: Grid */}
        <div class="flex md:grid md:grid-cols-3 gap-6 md:gap-12 overflow-x-auto md:overflow-hidden pb-8 md:pb-0 scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0 scroll-snap-x">
          {[
            { name: 'VIRAL TRENDS', image: 'https://images.unsplash.com/photo-1552374196-1ab2a1c593e8?q=80&w=1000&auto=format&fit=crop', link: 'viral-trends' },
            { name: 'SALE / OFF', image: 'https://images.unsplash.com/photo-1576995853123-5a10305d93c0?q=80&w=1000&auto=format&fit=crop', link: 'sale' },
            { name: 'BESTSELLERS', image: 'https://images.unsplash.com/photo-1483985988355-763728e1935b?q=80&w=1000&auto=format&fit=crop', link: 'bestsellers' }
          ].map((category) => (
            <a 
              href={`/category/${category.link}`}
              class="group relative min-w-[300px] md:min-w-0 h-[400px] md:h-[500px] overflow-hidden transition-all duration-500 border border-white/10 hover:border-white/40 flex-shrink-0 scroll-snap-align-start"
            >
              <div class="absolute inset-0 bg-black/60 group-hover:bg-black/40 transition-colors z-10"></div>
              <img src={category.image} alt={category.name} class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000 grayscale group-hover:grayscale-0" loading="lazy" />
              <div class="absolute inset-0 flex flex-col items-center justify-center z-20 p-8 text-center">
                <h3 class="text-3xl md:text-4xl font-urban font-black text-white mb-4 uppercase italic tracking-tighter group-hover:scale-110 transition-transform drop-shadow-[0_4px_4px_rgba(0,0,0,1)]">
                  {category.name}
                </h3>
                <div class="w-12 h-1 bg-white group-hover:w-24 transition-all duration-500"></div>
              </div>
            </a>
          ))}
        </div>
      </div>
  </section>

  {/* Newsletter Mockup */}
  <section class="py-16 md:py-24 bg-gray-50 px-4">
      <div class="container-custom text-center">
          <div class="max-w-2xl mx-auto p-8 md:p-12 bg-white border-2 border-black relative">
              <div class="absolute -top-3 -left-3 md:-top-4 md:-left-4 w-6 h-6 md:w-8 md:h-8 bg-black"></div>
              <div class="absolute -bottom-3 -right-3 md:-bottom-4 md:-right-4 w-6 h-6 md:w-8 md:h-8 bg-black text-white flex items-center justify-center font-bold font-urban text-sm md:text-base">!</div>
              <h2 class="text-3xl md:text-4xl font-urban font-black text-gray-900 mb-4 uppercase italic">Unete a la Resistencia</h2>
              <p class="text-gray-500 mb-8 font-bold uppercase tracking-widest text-[10px] md:text-sm">Get exclusive access to the next drops and 15% off</p>
              <form id="newsletter-form" class="flex flex-col md:flex-row gap-3">
                  <input type="email" id="newsletter-email" placeholder="YOUR@EMAIL.COM" class="flex-1 px-4 md:px-6 py-4 border-2 md:border-4 border-black font-black uppercase tracking-widest focus:outline-none text-sm" required />
                  <button type="submit" id="newsletter-btn" class="px-8 py-4 bg-black text-white font-black uppercase tracking-widest hover:bg-gray-800 transition-colors text-sm">JOIN</button>
              </form>
              <p id="newsletter-message" class="mt-4 text-sm font-medium hidden"></p>
          </div>
      </div>
  </section>

  {/* Value Propositions */}
  <section class="container-custom py-16 md:py-20 px-4 md:px-0">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-10 md:gap-12 text-center">
      <div class="flex flex-col items-center">
        <div class="w-14 h-14 md:w-16 md:h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 transition-transform hover:scale-110">
          <svg class="w-6 h-6 md:w-8 md:h-8 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h3 class="text-lg md:text-xl font-urban font-black text-black mb-2 uppercase tracking-tight">Calidad Premium</h3>
        <p class="text-gray-500 text-sm md:text-base">Materiales de primera calidad seleccionados cuidadosamente.</p>
      </div>
      <div class="flex flex-col items-center">
        <div class="w-14 h-14 md:w-16 md:h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 transition-transform hover:scale-110">
          <svg class="w-6 h-6 md:w-8 md:h-8 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <h3 class="text-lg md:text-xl font-urban font-black text-black mb-2 uppercase tracking-tight">Envío Rápido</h3>
        <p class="text-gray-500 text-sm md:text-base">Entrega express en 24-48 horas en toda España.</p>
      </div>
      <div class="flex flex-col items-center">
        <div class="w-14 h-14 md:w-16 md:h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 transition-transform hover:scale-110">
          <svg class="w-6 h-6 md:w-8 md:h-8 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
        </div>
        <h3 class="text-lg md:text-xl font-urban font-black text-black mb-2 uppercase tracking-tight">Devolución Fácil</h3>
        <p class="text-gray-500 text-sm md:text-base">30 días para devoluciones sin compromiso.</p>
      </div>
    </div>
  </section>
</PublicLayout>

<script>
  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const emailInput = document.getElementById('newsletter-email') as HTMLInputElement;
  const submitBtn = document.getElementById('newsletter-btn') as HTMLButtonElement;
  const messageEl = document.getElementById('newsletter-message') as HTMLParagraphElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = emailInput.value.trim();
    if (!email) return;

    submitBtn.disabled = true;
    submitBtn.textContent = '...';

    try {
      const response = await fetch('/api/newsletter', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      });

      const data = await response.json();

      messageEl.classList.remove('hidden', 'text-red-600', 'text-green-600');
      
      if (response.ok) {
        messageEl.classList.add('text-green-600');
        messageEl.textContent = data.message;
        emailInput.value = '';
      } else {
        messageEl.classList.add('text-red-600');
        messageEl.textContent = data.error;
      }
    } catch (error) {
      messageEl.classList.remove('hidden');
      messageEl.classList.add('text-red-600');
      messageEl.textContent = 'Error de conexión. Inténtalo de nuevo.';
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'JOIN';
    }
  });
</script>
